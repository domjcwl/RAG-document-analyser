<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>RAG Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      /* ---------- RESET ---------- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
      }

      body {
        background: #0f0f10;
        color: #ececec;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* ---------- HEADER ---------- */
      header {
        padding: 14px 20px;
        border-bottom: 1px solid #2a2a2a;
        background: #0f0f10;
        font-weight: 600;
        font-size: 16px;
      }

      /* ---------- CHAT AREA ---------- */
      .chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
      }

      .message {
        max-width: 800px;
        margin-bottom: 18px;
        line-height: 1.6;
        white-space: pre-wrap;
      }

      .user {
        margin-left: auto;
        background: #1f1f1f;
        padding: 12px 16px;
        border-radius: 12px;
      }

      .assistant {
        margin-right: auto;
        background: #161616;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #2a2a2a;
      }

      /* ---------- INPUT AREA ---------- */
      .input-area {
        border-top: 1px solid #2a2a2a;
        padding: 16px;
        background: #0f0f10;
      }

      .input-wrapper {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        gap: 12px;
      }

      textarea {
        flex: 1;
        resize: none;
        background: #1f1f1f;
        color: #ececec;
        border: 1px solid #2a2a2a;
        border-radius: 10px;
        padding: 12px;
        height: 48px;
        outline: none;
      }

      button {
        background: #10a37f;
        border: none;
        color: white;
        padding: 0 18px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
      }

      button:hover {
        opacity: 0.9;
      }

      /* ---------- UPLOAD ---------- */
      .upload-bar {
        max-width: 900px;
        margin: 0 auto 12px auto;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      input[type="file"] {
        color: #aaa;
      }

      .status {
        font-size: 13px;
        color: #aaa;
      }

      /* ---------- SCROLLBAR ---------- */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-thumb {
        background: #2a2a2a;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <header>üìÑ RAG Chatbot</header>

    <div class="chat-container" id="chat"></div>

    <div class="input-area">
      <div class="upload-bar">
        <input type="file" id="fileInput" />
        <button onclick="uploadFile()">Upload</button>
        <button onclick="removeFile()" style="background: #444">Remove</button>
        <span class="status" id="status"></span>
      </div>

      <div class="input-wrapper">
        <textarea
          id="messageInput"
          placeholder="Ask something about your document..."
        ></textarea>
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:8000";

      const chat = document.getElementById("chat");
      const messageInput = document.getElementById("messageInput");
      const statusText = document.getElementById("status");

      function addMessage(text, sender) {
        const div = document.createElement("div");
        div.className = `message ${sender}`;
        div.textContent = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
      }

      async function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;

        addMessage(message, "user");
        messageInput.value = "";

        try {
          const res = await fetch(`${API_BASE}/chat`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message }),
          });

          const data = await res.json();

          if (data.answer) {
            addMessage(data.answer, "assistant");
          } else {
            addMessage("‚ö†Ô∏è No document uploaded yet.", "assistant");
          }
        } catch (err) {
          addMessage("‚ùå Error contacting server", "assistant");
        }
      }

      async function uploadFile() {
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];
        if (!file) return;

        statusText.textContent = "Uploading...";

        const formData = new FormData();
        formData.append("file", file);

        try {
          const res = await fetch(`${API_BASE}/upload`, {
            method: "POST",
            body: formData,
          });

          const data = await res.json();
          statusText.textContent = `Uploaded: ${data.filename}`;
          chat.innerHTML = "";
        } catch (err) {
          statusText.textContent = "Upload failed";
        }
      }

      async function removeFile() {
        await fetch(`${API_BASE}/remove`, { method: "POST" });
        chat.innerHTML = "";
        statusText.textContent = "Document removed";
      }
    </script>
  </body>
</html>
